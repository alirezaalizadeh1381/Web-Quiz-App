@model Test
@{
    ViewData["Title"] = Model.Name;
}

<h1>@Model.Name</h1>
<p class="lead">@Model.Description</p>

<form asp-action="SubmitTest" method="post" id="testForm">
    <input type="hidden" name="testId" value="@Model.Id" />

    @for (int i = 0; i < Model.Questions.Count; i++)
    {
        var question = Model.Questions[i];
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">Question @(i + 1) of @Model.Questions.Count</h5>
            </div>
            <div class="card-body">
                @if (!string.IsNullOrWhiteSpace(question.CodeSnippet))
                {
                    <pre class="bg-dark text-light p-3 rounded">@question.CodeSnippet</pre>
                }
                else
                {
                    <div class="alert alert-info mb-3">
                        <i class="bi bi-info-circle"></i> No code snippet provided for this question
                    </div>
                }

                <div class="mb-3">
                    <h6>Question:</h6>
                    <p class="fs-5">@question.Content</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Your Answer:</label>
                    <textarea id="answer-@question.Id"
                        name="answers[@question.Id]"
                          class="form-control" 
                          rows="4"
                          maxlength="500"
                          placeholder="Type your answer here..."></textarea>
                </div>
            </div>
        </div>
    }

    <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-send"></i> Submit Test
        </button>
    </div>
</form>
@section Scripts {
    <script>
        const form = document.getElementById('testForm');
        form.addEventListener('submit', function (event) {
            if (!confirm('Are you sure you want to submit the test?')) {
                event.preventDefault();
                return;
            }
            form.querySelector('button[type="submit"]').disabled = true;
        });
    </script>
}